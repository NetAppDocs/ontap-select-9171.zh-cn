---
sidebar: sidebar 
permalink: task_adm_replace_drives_swraid.html 
keywords: administer, administering, web, software raid, replace drive 
summary: 当使用软件 RAID 的驱动器发生故障时， ONTAP Select会使用备用驱动器（如果有）并自动启动重建过程。这与FAS和AFF上的ONTAP 的工作方式类似。但是，如果没有可用的备用驱动器，则需要向ONTAP Select节点添加一个。 
---
= 更换ONTAP Select发生故障的软件 RAID 驱动器
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
当使用软件 RAID 的驱动器发生故障时， ONTAP Select会分配一个备用驱动器（如果有）并自动启动重建过程。这与ONTAP在FAS和AFF上的工作方式类似。但是，如果没有可用的备用驱动器，则需要向ONTAP Select节点添加一个。


NOTE: 移除故障驱动器和添加新驱动器（标记为备用驱动器）都必须通过ONTAP Select Deploy 执行。不支持使用 vSphere 将驱动器连接到ONTAP Select虚拟机。



== 识别故障驱动器

当驱动器出现故障时，您需要使用ONTAP CLI 来识别故障磁盘。

[role="tabbed-block"]
====
.KVM
--
.开始之前
您必须拥有ONTAP Select虚拟机的 VM ID，以及ONTAP Select和ONTAP Select Deploy 管理员帐户凭据。

.关于此任务
仅当ONTAP Select节点在 KVM 上运行并配置为使用软件 RAID 时才应使用此过程。

.步骤
. 在ONTAP Select CLI 中，确定要更换的磁盘：
+
.. 通过虚拟机中的序列号、UUID 或目标地址识别磁盘。
+
[listing]
----
disk show -fields serial,vmdisk-target-address,uuid
----
.. （可选）显示已分区磁盘的备用磁盘容量的完整列表。storage aggregate show-spare-disks


. 在 Linux 命令行界面，找到磁盘。
+
.. 检查系统设备，搜索磁盘序列号或 UUID（磁盘名称）：
+
[listing]
----
find /dev/disk/by-id/<SN|ID>
----
.. 检查虚拟机配置，搜索目标地址：
+
[listing]
----
virsh dumpxml VMID
----




--
.ESXi
--
.步骤
. 使用管理员帐户Sign inONTAP CLI。
. 识别发生故障的磁盘驱动器。
+
[listing]
----
<cluster name>::> storage disk show -container-type broken
Usable Disk Container Container
Disk Size Shelf Bay Type Type Name Owner
---------------- ---------- ----- --- ------- ----------- --------- --------
NET-1.4 893.3GB - - SSD broken - sti-rx2540-346a'
----


--
====


== 移除故障驱动器

确定发生故障的驱动器后，请移除磁盘。

[role="tabbed-block"]
====
.使用 Deploy 的 KVM
--
您可以从 KVM 主机上分离磁盘，作为更换磁盘的一部分，或者当不再需要磁盘时。

.开始之前
您必须拥有ONTAP Select和ONTAP Select Deploy 管理员帐户凭据。

.步骤
. 使用管理员帐户Sign in部署实用程序 Web 用户界面。
. 选择页面顶部的“*Clusters*”选项卡，然后从列表中选择所需的集群。
. 选择所需 HA 对或节点旁边的 *+*。
+
如果禁用该选项，Deploy 当前正在刷新存储信息。

. 在*编辑节点存储*页面上选择*编辑存储*。
. 取消选择要从节点分离的磁盘，输入ONTAP管理员凭据，然后选择 *编辑存储* 以应用更改。
. 选择“是”确认弹出窗口中的警告。
. 选择要监控的集群的“*事件*”选项卡并确认分离操作。
+
如果不再需要该物理磁盘，您可以从主机中移除它。



--
.使用 CLI 的 KVM
--
识别磁盘后，请按照以下步骤操作。

.步骤
. 从虚拟机中分离磁盘：
+
.. 转储配置。
+
[listing]
----
virsh dumpxml VMNAME > /PATH/disk.xml
----
.. 编辑文件并删除除要从虚拟机分离的磁盘之外的所有内容。
+
磁盘的目标地址应与ONTAP中的 vmdisk-target-address 字段相对应。

+
[listing]
----
<disk type='block' device='lun'>
  <driver name='qemu' type='raw' cache='directsync'/>
  <source dev='/dev/disk/by-id/ata- Micron_5100_MTFDDAK960TCC_171616D35277'/>
  <backingStore/>
  <target dev='sde' bus='scsi'/>
  <alias name='scsi0-0-0-4'/>
  <address type='drive' controller='0' bus='0' target='0' unit='4'/>
</disk>
----
.. 分离磁盘。
+
[listing]
----
virsh detach-disk --persistent /PATH/disk.xml
----


. 更换物理磁盘：
+
您可以使用诸如此类的工具。 `ledctl locate=`必要时定位物理磁盘。

+
.. 从主机中移除磁盘。
.. 如果需要，请选择一个新磁盘并将其安装在主机中。


. 编辑原有磁盘配置文件，添加新磁盘。
+
您应该根据需要更新磁盘路径和任何其他配置信息。

+
[listing]
----
<disk type='block' device='lun'>
  <driver name='qemu' type='raw' cache='directsync'/>
  <source dev='/dev/disk/by-id/ata-Micron_5100_MTFDDAK960TCC_171616D35277'/>
  <backingStore/>
  <target dev='sde' bus='scsi'/>
  <alias name='scsi0-0-0-4'/>
  <address type='drive' controller='0' bus='0' target='0' unit='4'/>
</disk>
----


--
.ESXi
--
.步骤
. 使用管理员帐户Sign inDeploy Web 用户界面。
. 选择“*Clusters*”选项卡并选择相关集群。
+
image:ST_22.jpg["节点详细信息"]

. 选择 *+* 展开存储视图。
+
image:ST_23.jpg["编辑节点存储"]

. 选择“*编辑*”对连接的磁盘进行更改并取消选中故障驱动器。
+
image:ST_24.jpg["存储磁盘详细信息"]

. 提供集群凭证并选择*编辑存储*。
+
image:ST_25.jpg["ONTAP 凭证"]

. 确认操作。
+
image:ST_26.jpg["警告"]



--
====


== 添加新的备用驱动器

移除故障驱动器后，添加备用磁盘。

[role="tabbed-block"]
====
.使用 Deploy 的 KVM
--
.使用 Deploy 附加磁盘
您可以将磁盘连接到 KVM 主机，作为更换磁盘的一部分或添加更多存储容量。

.开始之前
您必须拥有ONTAP Select和ONTAP Select Deploy 管理员帐户凭据。

新磁盘必须物理安装在 KVM Linux 主机上。

.步骤
. 使用管理员帐户Sign in部署实用程序 Web 用户界面。
. 选择页面顶部的“*Clusters*”选项卡，然后从列表中选择所需的集群。
. 选择所需 HA 对或节点旁边的 *+*。
+
如果禁用该选项，Deploy 当前正在刷新存储信息。

. 在*编辑节点存储*页面上选择*编辑存储*。
. 选择要连接到节点的磁盘，输入ONTAP管理员凭据，然后选择 *编辑存储* 以应用更改。
. 选择“*事件*”选项卡来监视并确认附加操作。
. 检查节点存储配置以确认磁盘已连接。


--
.使用 CLI 的 KVM
--
识别并移除故障驱动器后，您可以连接新的驱动器。

.步骤
. 将新磁盘附加到虚拟机。
+
[listing]
----
virsh attach-disk --persistent /PATH/disk.xml
----


.结果
该磁盘已分配为备用磁盘，可供ONTAP Select使用。该磁盘可能需要一分钟或更长时间才能变为可用状态。

.完成后
由于节点配置已更改，您应该使用 Deploy 管理实用程序执行集群刷新操作。

--
.ESXi
--
.步骤
. 使用管理员帐户Sign inDeploy Web 用户界面。
. 选择“*Clusters*”选项卡并选择相关集群。
+
image:ST_27.jpg["HA 对"]

. 选择 *+* 展开存储视图。
+
image:ST_28.jpg["编辑节点存储"]

. 选择*编辑*并确认新驱动器可用并选择它。
+
image:ST_29.jpg["存储磁盘详细信息"]

. 提供集群凭证并选择*编辑存储*。
+
image:ST_30.jpg["存储磁盘详细信息"]

. 确认操作。
+
image:ST_31.jpg["存储磁盘详细信息"]



--
====